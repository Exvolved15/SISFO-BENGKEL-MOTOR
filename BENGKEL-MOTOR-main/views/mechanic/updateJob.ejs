<h2>Detail Pengerjaan - <%= job.vehicle.licensePlate %></h2>

<div class="card mb-3">
    <div class="card-body">
        <p><strong>Pelanggan:</strong> <%= job.customer.name %></p>
        <p><strong>Kendaraan:</strong> <%= job.vehicle.model %></p>
    </div>
</div>

<div class="card">
    <div class="card-header bg-primary text-white">Input Suku Cadang & Jasa</div>
    <div class="card-body">
        <form id="addItemForm">
            <input type="hidden" id="jobId" value="<%= job._id %>">
            <div class="row">
                <div class="col-md-6">
                    <label>Pilih Item</label>
                    <select id="serviceId" class="form-select" required>
                        <% allServices.forEach(item => { %>
                            <option value="<%= item._id %>"><%= item.name %> (Stok: <%= item.stock %>)</option>
                        <% }) %>
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Qty</label>
                    <input type="number" id="quantity" class="form-control" value="1" min="1">
                </div>
                <div class="col-md-3">
                    <label>&nbsp;</label>
                    <button type="button" class="btn btn-success d-block" onclick="submitItem()">Tambah</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
async function submitItem() {
    const payload = {
        jobId: document.getElementById('jobId').value,
        serviceId: document.getElementById('serviceId').value,
        quantity: document.getElementById('quantity').value
    };

    const res = await fetch('/api/jobs/add-item', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    });

    const result = await res.json();
    if (res.ok) {
        alert('Item ditambahkan!');
        location.reload(); // Refresh untuk melihat daftar terbaru
    } else {
        alert('Gagal: ' + result.message);
    }
}
</script>