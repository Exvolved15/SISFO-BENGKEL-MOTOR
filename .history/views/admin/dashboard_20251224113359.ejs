<div class="container-fluid px-4 py-4 animate-fade-in">
    
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm overflow-hidden rounded-4">
                <div class="card-body p-0">
                    <div class="row g-0">
                        <div class="col-lg-8 p-4 d-flex align-items-center bg-white">
                            <div class="profile-avatar bg-success rounded-circle d-flex align-items-center justify-content-center text-white shadow-sm border border-4 border-light" 
                                 style="width: 80px; height: 80px; min-width: 80px;">
                                 <% if (user.profileImage) { %>
                                    <img src="<%= user.profileImage %>?t=<%= Date.now() %>" alt="Profile" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                                <% } else { %>
                                    <span class="h2 mb-0"><%= user.name.charAt(0).toUpperCase() %></span>
                                <% } %>
                            </div>
                            <div class="ms-4">
                                <h3 class="mb-1 fw-bold text-dark">Selamat Datang, <%= user.name %>!</h3>
                                <div class="d-flex flex-wrap gap-2">
                                    <span class="badge bg-success bg-opacity-10 text-success px-3 py-2 rounded-pill small">
                                        <i class="fas fa-shield-check me-1"></i> System Administrator
                                    </span>
                                    <span class="text-muted small mt-1"><i class="fas fa-clock me-1 text-warning"></i> Sesi: <%= new Date().toLocaleDateString('id-ID') %></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 bg-light p-4 d-flex align-items-center border-start">
                            <div class="w-100 text-center text-lg-start">
                                <p class="small text-muted fw-bold mb-2">STATUS INFRASTRUKTUR: <span class="text-success">ONLINE</span></p>
                                <a href="/users/edit/<%= user._id %>" class="btn btn-dark btn-sm rounded-pill px-4">
                                    <i class="fas fa-gear me-2"></i>Konfigurasi Profil
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-sm-6 col-xl-3">
            <div class="card bg-emerald-gradient text-white border-0 shadow-sm rounded-4 h-100 p-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <p class="small text-white-50 mb-1">Personel</p>
                        <h2 class="fw-bold mb-0"><%= users.length %></h2>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-3 p-2"><i class="fas fa-users-gear"></i></div>
                </div>
                <a href="/users" class="text-white text-decoration-none small mt-3">Detail Tim <i class="fas fa-chevron-right ms-1"></i></a>
            </div>
        </div>
        <div class="col-sm-6 col-xl-3">
            <div class="card bg-primary-gradient text-white border-0 shadow-sm rounded-4 h-100 p-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <p class="small text-white-50 mb-1">Inventaris</p>
                        <h2 class="fw-bold mb-0"><%= parts.length %></h2>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-3 p-2"><i class="fas fa-boxes-stacked"></i></div>
                </div>
                <a href="/parts" class="text-white text-decoration-none small mt-3">Cek Stok <i class="fas fa-chevron-right ms-1"></i></a>
            </div>
        </div>
        <div class="col-sm-6 col-xl-3">
            <div class="card bg-info-gradient text-white border-0 shadow-sm rounded-4 h-100 p-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <p class="small text-white-50 mb-1">Katalog Jasa</p>
                        <h2 class="fw-bold mb-0">SERVICES</h2>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-3 p-2"><i class="fas fa-wrench"></i></div>
                </div>
                <a href="/services" class="text-white text-decoration-none small mt-3">Lihat Jasa <i class="fas fa-chevron-right ms-1"></i></a>
            </div>
        </div>
        <div class="col-sm-6 col-xl-3">
            <div class="card bg-danger-gradient text-white border-0 shadow-sm rounded-4 h-100 p-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <p class="small text-white-50 mb-1">Sirkulasi</p>
                        <h2 class="fw-bold mb-0">TRANSAKSI</h2>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-3 p-2"><i class="fas fa-cart-shopping"></i></div>
                </div>
                <a href="/transactions" class="text-white text-decoration-none small mt-3">Arus Kas <i class="fas fa-chevron-right ms-1"></i></a>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-xl-8">
            <div class="card border-0 shadow-sm rounded-4 p-4 h-100 bg-white">
                <h5 class="fw-bold mb-4 text-dark"><i class="fas fa-bolt text-warning me-2"></i>Akses Cepat Operasional</h5>
                <div class="row g-3">
                    <div class="col-6 col-md-3">
                        <a href="/register" class="quick-card p-3 border rounded-4 text-center text-decoration-none d-block">
                            <div class="icon-circle bg-primary-soft text-primary mx-auto mb-2"><i class="fas fa-user-plus"></i></div>
                            <span class="text-dark small fw-bold d-block">Staf Baru</span>
                        </a>
                    </div>
                    <div class="col-6 col-md-3">
                        <a href="/parts/add" class="quick-card p-3 border rounded-4 text-center text-decoration-none d-block">
                            <div class="icon-circle bg-success-soft text-success mx-auto mb-2"><i class="fas fa-plus-square"></i></div>
                            <span class="text-dark small fw-bold d-block">Stok Barang</span>
                        </a>
                    </div>
                    <div class="col-6 col-md-3">
                        <a href="/services/add" class="quick-card p-3 border rounded-4 text-center text-decoration-none d-block">
                            <div class="icon-circle bg-info-soft text-info mx-auto mb-2"><i class="fas fa-user-gear"></i></div>
                            <span class="text-dark small fw-bold d-block">Tambah Jasa</span>
                        </a>
                    </div>
                    <div class="col-6 col-md-3">
                        <button onclick="window.print()" class="quick-card p-3 border rounded-4 text-center w-100 bg-white d-block">
                            <div class="icon-circle bg-danger-soft text-danger mx-auto mb-2"><i class="fas fa-file-pdf"></i></div>
                            <span class="text-dark small fw-bold d-block">Cetak Laporan</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-4">
            <div class="card bg-primary text-white border-0 shadow-sm rounded-4 p-4 h-100 d-flex flex-column justify-content-between">
                <div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="fw-bold mb-0">Analisis Keuangan</h5>
                        <i class="fas fa-chart-line fa-lg opacity-50"></i>
                    </div>
                    <p class="small text-white-50">Pantau performa harian berdasarkan selisih harga beli dan harga jual secara real-time.</p>
                </div>
                <div class="mt-auto pt-3">
                    <hr class="opacity-25">
                    <a href="/admin/report" class="btn btn-light w-100 rounded-pill fw-bold">
                        Buka Laporan Laba Rugi <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4 bg-white overflow-hidden">
                <div class="card-header bg-dark text-white py-3"><h6 class="mb-0 small fw-bold">PERSONEL AKTIF</h6></div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <tbody class="small text-nowrap">
                            <% users.filter(u => u.role !== 'customer').slice(0, 5).forEach(u => { %>
                                <tr>
                                    <td class="ps-3"><div class="avatar-sm bg-light text-dark fw-bold rounded-2 text-center" style="width: 30px; height: 30px; line-height: 30px;"><%= u.name.charAt(0) %></div></td>
                                    <td><div class="fw-bold text-dark"><%= u.name %></div><small class="text-muted"><%= u.role %></small></td>
                                    <td class="text-end pe-3"><span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3">AKTIF</span></td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4 bg-white overflow-hidden">
                <div class="card-header bg-danger text-white py-3"><h6 class="mb-0 small fw-bold">STOK KRITIS (&le; 5)</h6></div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <tbody class="small text-nowrap">
                            <% const lowStock = parts.filter(p => p.stock <= 5); %>
                            <% if (lowStock.length > 0) { %>
                                <% lowStock.forEach(part => { %>
                                    <tr>
                                        <td class="ps-3 fw-bold text-dark"><%= part.name %></td>
                                        <td><span class="badge bg-danger rounded-pill px-2"><%= part.stock %> Unit</span></td>
                                        <td class="text-end pe-3">
                                            <form action="/api/parts/update-stock/<%= part._id %>" method="POST">
                                                <input type="hidden" name="adjustment" value="10">
                                                <button type="submit" class="btn btn-xs btn-outline-success rounded-pill px-3">+10 Stok</button>
                                            </form>
                                        </td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr><td colspan="3" class="text-center py-4 text-muted">Semua stok barang aman.</td></tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Gradient Colors */
    .bg-emerald-gradient { background: linear-gradient(135deg, #2ecc71, #27ae60); }
    .bg-primary-gradient { background: linear-gradient(135deg, #3498db, #2980b9); }
    .bg-info-gradient { background: linear-gradient(135deg, #17a2b8, #117a8b); }
    .bg-danger-gradient { background: linear-gradient(135deg, #e74c3c, #c0392b); }

    /* Soft Colors for Icons */
    .bg-primary-soft { background: #e7f3ff; } .bg-success-soft { background: #e8f7ee; }
    .bg-info-soft { background: #e3f9fb; } .bg-danger-soft { background: #fdf2f2; }

    /* Layout Helpers */
    .quick-card { transition: 0.3s; border: 1px solid #f0f0f0 !important; cursor: pointer; }
    .quick-card:hover { transform: translateY(-3px); background-color: #fcfcfc !important; border-color: #27ae60 !important; }
    .icon-circle { width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
    .btn-xs { padding: 0.2rem 0.5rem; font-size: 0.7rem; }

    /* Animation */
    .animate-fade-in { animation: fadeIn 0.8s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>