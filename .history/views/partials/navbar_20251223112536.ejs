<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm py-2">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/" style="letter-spacing: 1px;">
            <i class="fas fa-wrench me-2" style="color: #2ecc71;"></i><span class="brand-border">SISFO BENGKEL</span>
        </a>

        <div class="d-flex align-items-center ms-lg-4 me-auto">
            <ul class="nav flex-row align-items-center">
                <li class="nav-item">
                    <a class="nav-link px-2 text-white <%= (typeof activePage !== 'undefined' && activePage === 'home') ? 'fw-bold active border-bottom border-success' : '' %>" href="/">Overview</a>
                </li>
                <li class="nav-item border-start border-secondary ms-2 ps-2">
                    <a class="nav-link px-2 text-white <%= (typeof activePage !== 'undefined' && activePage === 'about') ? 'fw-bold active border-bottom border-success' : '' %>" href="/about">About</a>
                </li>
            </ul>
        </div>

        <% if (typeof user !== 'undefined' && user) { %>
            <button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#navInternal">
                <span class="navbar-toggler-icon"></span>
            </button>
        <% } %>

        <div class="collapse navbar-collapse" id="navInternal">
            <ul class="navbar-nav ms-auto align-items-lg-center">
                
                <% if (typeof user !== 'undefined' && user) { %>
                    <% if (user.role === 'admin' || user.role === 'kasir') { %>
                        <li class="nav-item"><a class="nav-link" href="/parts">Suku Cadang</a></li>
                        <li class="nav-item"><a class="nav-link" href="/services">Jasa</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="dropTrans" data-bs-toggle="dropdown">Transaksi</a>
                            <ul class="dropdown-menu dropdown-menu-dark shadow border-secondary">
                                <li><a class="dropdown-item" href="/transactions/add">Baru</a></li>
                                <li><a class="dropdown-item" href="/transactions">Riwayat</a></li>
                            </ul>
                        </li>
                    <% } %>

                    <% if (user.role === 'mekanik') { %>
                        <li class="nav-item">
                            <a class="nav-link" href="/api/jobs/mechanic/dashboard"><i class="fas fa-tools me-1"></i>Tugas</a>
                        </li>
                    <% } %>

                    <li class="nav-item dropdown ms-lg-3 mt-2 mt-lg-0">
                        <a class="nav-link dropdown-toggle d-flex align-items-center profile-pill" href="#" id="userProfileDrop" role="button" data-bs-toggle="dropdown">
                            <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 28px; height: 28px; font-weight: bold; font-size: 0.8rem;">
                                <%= user.name.charAt(0).toUpperCase() %>
                            </div>
                            <span class="small text-white me-1"><%= user.name %></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark shadow border-secondary mt-2">
                            <li class="px-3 py-1"><small class="text-muted text-uppercase" style="font-size: 0.6rem;">Role: <%= user.role %></small></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/users/edit/<%= user._id %>"><i class="fas fa-user-circle me-2"></i>Profil</a></li>
                            <li><a class="dropdown-item text-danger" id="logout-link" href="/logout"><i class="fas fa-sign-out-alt me-2"></i>Keluar</a></li>
                        </ul>
                    </li>

                <% } else { %>
                    <li class="nav-item ms-lg-3">
                        <a href="/login" class="btn btn-emerald btn-lg-hover px-4 py-2 shadow-sm d-flex align-items-center">
                            <i class="fas fa-sign-in-alt me-2"></i><span>Masuk</span>
                        </a>
                    </li>
                <% } %>
            </ul>
        </div>
    </div>
</nav>

<style>
    /* Brand Styling */
    .brand-border {
        color: #2ecc71;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        font-weight: 800;
    }

    /* Tombol Emerald (Hijau Tema Baru) */
    .btn-emerald {
        background-color: #2ecc71;
        border: 2px solid #1b7e43;
        color: white;
        font-weight: 700;
        border-radius: 8px;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    .btn-emerald:hover {
        background-color: #27ae60;
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4) !important;
        color: white;
    }

    /* Profile Pill Hover */
    .profile-pill {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 50px;
        transition: background 0.3s ease;
    }
    .profile-pill:hover {
        background-color: rgba(46, 204, 113, 0.2);
    }

    /* Nav Link Active */
    .nav-link.active {
        color: #2ecc71 !important;
        text-shadow: 0px 0px 5px rgba(46, 204, 113, 0.3);
    }

    /* Global Hover effect untuk dropdown */
    .dropdown-item:hover {
        background-color: rgba(46, 204, 113, 0.2);
        color: #2ecc71 !important;
    }
</style>

<script type="module">
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    const logoutLink = document.getElementById('logout-link');
    if (logoutLink) {
        logoutLink.addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                const auth = getAuth();
                await signOut(auth);
            } catch (err) { console.error(err); }
            window.location.href = '/logout';
        });
    }
</script>