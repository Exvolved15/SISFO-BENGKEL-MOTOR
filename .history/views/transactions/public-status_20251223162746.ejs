<div class="container py-5 animate-fade-in">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-7">
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                <div class="card-header bg-emerald-gradient text-white text-center py-5 border-0">
                    <div class="mb-2">
                        <i class="fas fa-motorcycle fa-3x animate-bounce"></i>
                    </div>
                    <h2 class="fw-bold mb-1">STATUS SERVIS</h2>
                    <p class="opacity-75 mb-0 font-monospace">Invoice: <%= transaction.invoiceNumber %></p>
                </div>

                <div class="card-body p-4 p-md-5 bg-white">
                    <div class="alert bg-light border-0 rounded-4 p-3 mb-5 d-flex align-items-center shadow-inner">
                        <div class="flex-grow-1 border-end pe-3">
                            <small class="text-muted d-block text-uppercase fw-bold" style="font-size: 0.7rem;">Pemilik Unit</small>
                            <span class="fw-bold text-dark fs-5"><%= transaction.customerName %></span>
                        </div>
                        <div class="ps-3 flex-grow-1">
                            <small class="text-muted d-block text-uppercase fw-bold" style="font-size: 0.7rem;">Kendaraan</small>
                            <span class="fw-bold text-dark fs-5"><%= transaction.motorName %></span>
                            <div class="badge bg-dark font-monospace"><%= transaction.vehicleLicense %></div>
                        </div>
                    </div>

                    <div class="tracking-list">
                        <% 
                            let status = job ? job.status : 'pending'; 
                            let step1 = 'active', step2 = '', step3 = '';
                            let icon1 = 'fa-check-circle', icon2 = 'fa-circle', icon3 = 'fa-circle';

                            if(status === 'on_progress') {
                                step2 = 'active';
                                icon2 = 'fa-hammer fa-spin';
                            } else if(status === 'completed') {
                                step2 = 'active';
                                step3 = 'active';
                                icon2 = 'fa-check-circle';
                                icon3 = 'fa-flag-checkered';
                            }
                        %>

                        <div class="tracking-item <%= step1 %>">
                            <div class="tracking-icon status-active">
                                <i class="fas <%= icon1 %>"></i>
                            </div>
                            <div class="tracking-content">
                                <h6 class="fw-bold mb-0">Pesanan Diterima</h6>
                                <p class="text-muted small">Unit Anda sudah masuk dalam antrean bengkel.</p>
                            </div>
                        </div>

                        <div class="tracking-item <%= step2 %>">
                            <div class="tracking-icon <%= status === 'on_progress' ? 'status-in-progress' : (status === 'completed' ? 'status-active' : '') %>">
                                <i class="fas <%= icon2 %>"></i>
                            </div>
                            <div class="tracking-content">
                                <h6 class="fw-bold mb-0">Sedang Dikerjakan</h6>
                                <p class="text-muted small">Mekanik kami sedang melakukan servis pada unit Anda.</p>
                            </div>
                        </div>

                        <div class="tracking-item <%= step3 %>">
                            <div class="tracking-icon <%= status === 'completed' ? 'status-active' : '' %>">
                                <i class="fas <%= icon3 %>"></i>
                            </div>
                            <div class="tracking-content">
                                <h6 class="fw-bold mb-0">Servis Selesai</h6>
                                <p class="text-muted small">Pekerjaan tuntas. Unit siap diambil dan dilakukan pembayaran.</p>
                            </div>
                        </div>
                    </div>

                    <div class="text-center mt-5">
                        <% if(status !== 'completed') { %>
                            <div class="p-3 bg-warning bg-opacity-10 border border-warning border-opacity-25 rounded-4 mb-4">
                                <p class="small mb-0 text-dark">
                                    <i class="fas fa-info-circle me-1"></i> Mohon tunggu sebentar, kami memberikan perawatan terbaik untuk motor Anda.
                                </p>
                            </div>
                        <% } else { %>
                            <div class="p-3 bg-success bg-opacity-10 border border-success border-opacity-25 rounded-4 mb-4">
                                <p class="small mb-0 text-success fw-bold">
                                    <i class="fas fa-star me-1"></i> Motor Anda telah siap! Silakan hubungi kasir.
                                </p>
                            </div>
                        <% } %>
                        
                        <a href="/" class="btn btn-outline-secondary px-5 rounded-pill fw-bold">
                            <i class="fas fa-arrow-left me-2"></i>KEMBALI KE BERANDA
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* TIMELINE STYLING */
    .tracking-list {
        position: relative;
        padding-left: 50px;
    }

    .tracking-item {
        position: relative;
        padding-bottom: 40px;
    }

    .tracking-item:last-child {
        padding-bottom: 0;
    }

    /* Garis Penghubung */
    .tracking-item::before {
        content: '';
        position: absolute;
        left: -31px;
        top: 30px;
        width: 2px;
        height: 100%;
        background: #e9ecef;
        z-index: 1;
    }

    .tracking-item:last-child::before {
        display: none;
    }

    .tracking-item.active::before {
        background: #2ecc71;
    }

    /* Ikon Status */
    .tracking-icon {
        position: absolute;
        left: -45px;
        top: 0;
        width: 30px;
        height: 30px;
        background: #fff;
        border: 2px solid #e9ecef;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
        color: #dee2e6;
        transition: 0.3s;
    }

    .tracking-item.active .tracking-icon {
        border-color: #2ecc71;
        color: #2ecc71;
        box-shadow: 0 0 10px rgba(46, 204, 113, 0.3);
    }

    .status-active { color: #2ecc71 !important; border-color: #2ecc71 !important; }
    .status-in-progress { color: #f1c40f !important; border-color: #f1c40f !important; animation: pulse-yellow 2s infinite; }

    @keyframes pulse-yellow {
        0% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(241, 196, 15, 0); }
        100% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0); }
    }

    .bg-emerald-gradient { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }
    .shadow-inner { box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05); }
    
    .animate-fade-in { animation: fadeIn 0.8s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    .animate-bounce { animation: bounce 2s infinite; }
    @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
</style>