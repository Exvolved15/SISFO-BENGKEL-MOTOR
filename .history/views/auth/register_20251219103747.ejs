<div class="row justify-content-center mt-5">
    <div class="col-md-6 col-lg-5">
        <div class="card shadow-lg border-0 rounded-lg">
            <div class="card-header bg-primary text-white text-center py-3">
                <h3 class="font-weight-light my-0">Buat Akun Baru</h3>
            </div>
            <div class="card-body p-4">
                
                <div id="alertMessage" class="alert d-none" role="alert"></div>

                <form id="registerForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="name" name="name" placeholder="Contoh: Admin Bengkel" required>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Alamat Email</label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="nama@email.com" required autocomplete="username">
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" name="password" required autocomplete="new-password">
                        </div>
                        <div class="col-md-6">
                            <label for="confirmPassword" class="form-label">Konfirmasi Password</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required autocomplete="new-password">
                        </div>
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-primary btn-lg" id="btnSubmit">
                            <i class="fas fa-user-plus me-2"></i> Daftar Sekarang
                        </button>
                    </div>
                </form>
            </div>
            <div class="card-footer text-center py-3">
                <div class="small">
                    Sudah punya akun? <a href="/login" class="text-primary fw-bold">Login disini</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const registerForm = document.getElementById('registerForm');
    const alertMessage = document.getElementById('alertMessage');
    const btnSubmit = document.getElementById('btnSubmit');

    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault(); // Mencegah reload halaman 404

        // 1. Ambil Data Input
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // 2. Validasi Password Sederhana
        if (password !== confirmPassword) {
            showAlert('Password dan Konfirmasi tidak cocok!', 'danger');
            return;
        }

        // 3. Ubah Tombol jadi Loading
        const originalBtnText = btnSubmit.innerHTML;
        btnSubmit.disabled = true;
        btnSubmit.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...';

        try {
            // 4. Kirim Data ke API Backend (/api/auth/register)
            const res = await fetch('/api/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email, password })
            });

            const data = await res.json();

            if (res.ok) {
                // SUKSES: Tampilkan pesan hijau & Redirect ke Login
                showAlert('Registrasi Berhasil! Mengalihkan ke login...', 'success');
                setTimeout(() => {
                    window.location.href = '/login?success=1';
                }, 1500);
            } else {
                // GAGAL: Tampilkan pesan error dari server
                showAlert(data.message || 'Terjadi kesalahan saat mendaftar.', 'danger');
                resetButton(originalBtnText);
            }

        } catch (error) {
            console.error('Error:', error);
            showAlert('Gagal menghubungi server. Cek koneksi Anda.', 'danger');
            resetButton(originalBtnText);
        }
    });

    function showAlert(message, type) {
        alertMessage.className = `alert alert-${type}`;
        alertMessage.textContent = message;
        alertMessage.classList.remove('d-none');
    }

    function resetButton(text) {
        btnSubmit.disabled = false;
        btnSubmit.innerHTML = text;
    }
</script>