<div class="row justify-content-center mt-5">
    <div class="col-md-6 col-lg-5">
        <div class="card shadow-lg border-0 rounded-lg">
            <div class="card-header bg-primary text-white text-center py-3">
                <h3 class="font-weight-light my-0">Buat Akun Baru</h3>
            </div>
            <div class="card-body p-4">
                
                <div id="alertMessage" class="alert d-none" role="alert"></div>

                <form id="registerForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="name" name="name" placeholder="Nama User" required>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="email@contoh.com" required>
                    </div>

                    <div class="mb-3">
                        <label for="role" class="form-label">Daftar Sebagai (Role)</label>
                        <select class="form-select" id="role" name="role">
                            <option value="user">Pelanggan (User)</option>
                            <option value="mekanik">Mekanik</option>
                            <option value="kasir">Kasir</option>
                            <option value="admin">Admin (Khusus Demo)</option>
                        </select>
                        <div class="form-text text-muted">Pilih role sesuai skenario demo.</div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                        <div class="col-md-6">
                            <label for="confirmPassword" class="form-label">Konfirmasi</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                        </div>
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-primary btn-lg shadow-sm" id="btnSubmit">
                            Daftar Sekarang
                        </button>
                    </div>
                </form>
            </div>
            <div class="card-footer text-center py-3">
                <div class="small">
                    Sudah punya akun? <a href="/login">Login disini</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const registerForm = document.getElementById('registerForm');
    const alertMessage = document.getElementById('alertMessage');
    const btnSubmit = document.getElementById('btnSubmit');

    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const role = document.getElementById('role').value; // Ambil nilai Role
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            showAlert('Password tidak cocok!', 'danger');
            return;
        }

        // Loading state
        const originalText = btnSubmit.innerHTML;
        btnSubmit.disabled = true;
        btnSubmit.innerHTML = 'Loading...';

        try {
            const res = await fetch('/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, password, role }) // Kirim Role ke Server
            });

            const data = await res.json();

            if (res.ok) {
                showAlert('Registrasi Berhasil! Redirecting...', 'success');
                setTimeout(() => window.location.href = '/login?success=1', 1500);
            } else {
                showAlert(data.message || 'Gagal Mendaftar', 'danger');
                btnSubmit.disabled = false;
                btnSubmit.innerHTML = originalText;
            }
        } catch (error) {
            console.error(error);
            showAlert('Error koneksi server', 'danger');
            btnSubmit.disabled = false;
            btnSubmit.innerHTML = originalText;
        }
    });

    function showAlert(msg, type) {
        alertMessage.className = `alert alert-${type}`;
        alertMessage.textContent = msg;
        alertMessage.classList.remove('d-none');
    }
</script>