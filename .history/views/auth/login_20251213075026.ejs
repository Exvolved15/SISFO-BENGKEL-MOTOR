<script type="module">
    // 1. Ganti import ini agar sesuai dengan konfigurasi Anda
    import auth from '/js/firebaseAuth.js'; 
    import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"; // Import fungsi Firebase Auth

    // 2. Event Listener Form
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault(); // Mencegah form submit default

        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorMessageDiv = document.getElementById('errorMessage');

        errorMessageDiv.textContent = '';
        
        try {
            // 3. Login di Firebase
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            const idToken = await userCredential.user.getIdToken(); // Ambil ID Token

            // 4. Kirim Token ke Server Kita (Server Verification)
            const response = await fetch('/api/auth/verify-token', { // Route ini akan dibuat di Langkah 29.4
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ idToken: idToken })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Login gagal di sisi server.');
            }

            // 5. Sukses: Redirect ke dashboard
            window.location.href = '/'; 

        } catch (error) {
            console.error(error);
            errorMessageDiv.textContent = 'Login Gagal: ' + (error.message || error.code || 'Email atau Password salah.');
        }
    });
</script>